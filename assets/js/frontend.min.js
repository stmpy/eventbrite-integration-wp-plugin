var CategoryLayout,ColumnLayout,Event,EventView,Events,EventsApp,MapLayout,Tab,Tabs,ThirdColumnView;EventsApp=new Marionette.Application({regions:{application:".main-content"}}),Event=Backbone.Model.extend({initialize:function(){return this.set("local_url","/"+EventsApp.ops.evi_event_detail_page+"/?"+EventsApp.ops.evi_event_id_variable+"="+this.get("ID"))}}),Events=Backbone.Collection.extend({model:Event}),Tab=Backbone.Model.extend({}),Tabs=Backbone.Collection.extend({model:Tab}),EventView=Marionette.ItemView.extend({className:"eventbrite-event",template:function(a){return _.template(EventsApp.ops.evi_event_template)(a)}}),ThirdColumnView=Marionette.CollectionView.extend({className:"vc_span4 wpb_column column_container col no-extra-padding",childView:EventView}),ColumnLayout=Marionette.LayoutView.extend({className:"vc_row-fluid",regions:{column1:"#column1",column2:"#column2",column3:"#column3"},template:_.template(""),_mapping:{3:ThirdColumnView},onRender:function(){var a,b;return b=this,a=this._mapping[this.getOption("column_count")],_.each(this.getOption("columns"),function(c){return b.$el.append(new a({collection:new Events(c)}).render().el)})}}),CategoryLayout=Marionette.LayoutView.extend({template:_.template(""),onRender:function(){var a;return a=this,_.each(this.getOption("categories"),function(b,c){return a.$el.append("<div class='vc_row-fluid'><div class='vc_span12 col'><h4 class='eventbrite-category-title'>"+c+"</h4></div></div>",new ColumnLayout({column_count:3,columns:_.groupBy(b,function(a,b){return parseInt(b%3+1)})}).render().el)})}}),MapLayout=Marionette.LayoutView.extend({template:_.template(""),className:"eventbrite-list-map row",markers:[],onRender:function(){var a,b;return a=this,_.isUndefined(this.map)&&(this.map=new google.maps.Map(EventsApp.map.el,{zoom:4,center:new google.maps.LatLng(37.09024,-95.712891),scrollwheel:EventsApp.ops.evi_enable_scroll_wheel,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}}),_.isEmpty(EventsApp.ops.evi_map_style)||(b=new google.maps.StyledMapType(JSON.parse(EventsApp.ops.evi_map_style),{name:EventsApp.ops.evi_map_style_name}),this.map.mapTypes.set("map_style",b),this.map.setMapTypeId("map_style"))),this._geoLocate(),this.getOption("evnts").each(function(b){return a.drawMarker(new google.maps.LatLng(parseFloat(b.get("venue").latitude),parseFloat(b.get("venue").longitude)),b.get("local_url"))}),google.maps.event.addListenerOnce(this.map,"tilesloaded",function(){return google.maps.event.addListenerOnce(a.map,"tilesloaded",function(){return google.maps.event.trigger(a.map,"resize")})}),google.maps.event.addListenerOnce(this.map,"resize",function(){return a._geoLocate()})},drawMarker:function(a,b){var c,d;return null==b&&(b=null),d={map:this.map,position:a,animation:google.maps.Animation.DROP},b&&(d.url=b),EventsApp.ops.evi_marker_icon&&(d.icon=EventsApp.ops.evi_marker_icon),this.markers.push(c=new google.maps.Marker(d)),google.maps.event.addListener(c,"click",function(){return window.location.href=this.url})},_geoLocate:function(){var a;return _.isUndefined(navigator.geolocation.getCurrentPosition)?void 0:(a=this,navigator.geolocation.getCurrentPosition(function(b){return a._setMyLocation(b.coords.latitude,b.coords.longitude)},function(){return a._ipLocate()}))},_ipLocate:function(){return EventsApp.$.ajax("http://ipinfo.io",{context:this,success:function(a){var b;return b=a.loc.split(","),this._setMyLocation(parseFloat(b[0]),parseFloat(b[1]))},dataType:"jsonp"})},_setMyLocation:function(a,b){var c,d;return d=new google.maps.LatLng(parseFloat(a),parseFloat(b)),this.map.setCenter(d),this.map.setZoom(6),EventsApp.nearby?(c=new Events(_.sortBy(EventsApp.events_raw,function(a){return 62137e-8*google.maps.geometry.spherical.computeDistanceBetween(d,new google.maps.LatLng(a.venue.latitude,a.venue.longitude))})),EventsApp.nearby.show(new CategoryLayout({categories:{"Closest to Furthest":c.models.slice(0,3)}}))):void 0}}),EventsApp.addInitializer(function(a){var b,c,d,e,f,g,h;for(this.ops=a,d={},h=["upcoming","alphabetical","nearby","map"],f=0,g=h.length;g>f;f++)e=h[f],EventsApp.$(a["evi_"+e+"_tag_id"]).length>0&&(d[e]=a["evi_"+e+"_tag_id"]);return this.addRegions(d),this.events_raw=_.filter(a.events,function(b){return b.organizer.id===a.evi_organizer_id}),this.events={byDate:new Events(_.sortBy(this.events_raw,function(a){return a.start.local})),byCity:new Events(_.sortBy(this.events_raw,function(b){var c,d,e,f,g;for(c=b,g=a.evi_alphabetical_event_attribute.split("."),e=0,f=g.length;f>e;e++)d=g[e],c=c[d];return c.substr(0,1)})),noSort:new Events(this.events_raw)},c=this.events.byDate.groupBy(function(a){return moment(a.get("start").local).format("MMMM YYYY")}),this.upcoming&&this.upcoming.show(new CategoryLayout({categories:c})),b=this.events.byCity.groupBy(function(b){var c,d,e,f,g;for(c=b.attributes,g=a.evi_alphabetical_event_attribute.split("."),e=0,f=g.length;f>e;e++)d=g[e],c=c[d];return c}),this.alphabetical&&this.alphabetical.show(new CategoryLayout({categories:b})),this.map?this.map.show(new MapLayout({evnts:this.events.noSort})):void 0}),jQuery(document).ready(function(a){return EventsApp.$=a,_.isUndefined(data.events)?void 0:EventsApp.start(data.events)});var Event,EventApp,EventDetails,EventLinks,EventView,Link,LinkList,Ticket,Tickets,TicketsView;EventApp=new Marionette.Application,Event=Backbone.Model.extend({initialize:function(a){var b,c,d;return d=a.start,c=moment(d.local),b=moment(a.end.local),d.formatted=c.format("dddd, MMMM Do, YYYY")+" from "+c.format("h:mm a")+" to "+b.format("h:mm a zz"),this.set("start",d)}}),EventView=Marionette.ItemView.extend({initialize:function(a){return a.template?this.template=a.template:void 0}}),Link=Backbone.Model.extend({initialize:function(a){return this.set("icon",'<i class="'+a.icon_name+'"></i>')}}),LinkList=Backbone.Collection.extend({model:Link}),EventLinks=Marionette.CollectionView.extend({className:"event-buttons",childView:EventView,initialize:function(a){return a.template?this.template=a.template:void 0},onRender:function(){return this.$el.children().each(function(a,b){var c;return(c=EventApp.$(b).find("a")).attr("onclick","_gaq.push(['_link', '"+c.attr("href")+"']); return false;")})},childViewOptions:function(){return{template:this.template}}}),Ticket=Backbone.Model.extend({initialize:function(a){var b,c;return a.free?this.set("price","Free"):this.set("price",a.cost.display),b=moment(a.sales_end),c=moment().add(2,"weeks"),b.isBefore(c)?this.set("timeleft","only "+b.diff(moment(),"days")+" days left at this price"):this.set("timeleft","until "+b.format("MMMM Do YYYY"))}}),Tickets=Backbone.Collection.extend({model:Ticket}),TicketsView=Marionette.CollectionView.extend({childView:EventView,initialize:function(a){return a.template?this.template=a.template:void 0},childViewOptions:function(){return{template:this.template}}}),EventApp.showRegForm=function(){return EventApp.$(".eventbrite-event-private").each(function(a,b){return EventApp.$(b).show()})},EventApp.showPublicDetails=function(){return EventApp.$(".eventbrite-event-public").each(function(a,b){return EventApp.$(b).show()})},EventApp.displayLinks=function(a){return this.event_links.$el.each(function(b,c){return EventApp.$(c).html(new EventLinks({collection:new LinkList([{url:a.get("url")+"?team_reg_type=individual",icon_name:"icomoon-user",text:"Participate as an individual"},{url:a.get("url")+"#team-search",icon_name:"icomoon-users",text:"Join a team"},{url:a.get("url")+"#team-create",icon_name:"icomoon-plus",text:"Create a team"},{url:"https://www.eventbrite.com/mytickets/",icon_name:"icomoon-cog",text:"Manage your team"}]),template:function(a){return Handlebars.compile(EventApp.$(c).html())(a)+"<br />"}}).render().el)})},EventDetails=Marionette.ItemView.extend({}),EventApp.displayTickets=function(a){return this.event_tickets.$el.each(function(b,c){return EventApp.$(c).html(new TicketsView({collection:new Tickets(a.get("tickets").filter(function(a){return moment(a.sales_start).isBefore(moment().add(2,"weeks"),"day")})),template:function(a){return Handlebars.compile(EventApp.$(c).html())(a)+"<br />"}}).render().el)})},EventApp.displayWhenWhere=function(a){return this.event_when_where.$el.each(function(b,c){return EventApp.$(c).html(new EventView({model:a,template:function(a){return Handlebars.compile(EventApp.$(c).html())(a)}}).render().el)})},EventApp.displaySettings=function(a){return this.event_settings.$el.each(function(b,c){return EventApp.$(c).html(new EventDetails({model:a,template:function(a){return Handlebars.compile(EventApp.$(c).html())(a)}}).render().el)})},EventApp.drawMap=function(a){var b;return b=new google.maps.LatLng(a.get("venue").latitude,a.get("venue").longitude),this.map.$el.each(function(a,c){var d,e,f;return d=new google.maps.Map(c,{zoom:11,center:b,scrollwheel:EventApp.ops.evi_enable_scroll_wheel,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}}),_.isEmpty(EventApp.ops.evi_map_style)||(f=new google.maps.StyledMapType(JSON.parse(EventApp.ops.evi_map_style),{name:EventApp.ops.evi_map_style_name}),d.mapTypes.set("map_style",f),d.setMapTypeId("map_style")),e={map:d,position:b,animation:google.maps.Animation.DROP},EventApp.ops.evi_marker_icon&&(e.icon=EventApp.ops.evi_marker_icon),new google.maps.Marker(e)})},EventApp.addInitializer(function(a){var b,c,d,e,f,g;for(this.ops=a,c={},g=["event_links","event_tickets","event_when_where","map","event_settings"],e=0,f=g.length;f>e;e++)d=g[e],EventApp.$(a["evi_"+d+"_tag_id"]).length>0&&(c[d]=a["evi_"+d+"_tag_id"]);return this.addRegions(c),b=new Event(a.event),_.isEmpty(a.event.ID)?(EventApp.$(".subheader").html("").prev().html(""),void(confirm("Unable to Find event, click 'OK' to view all locations,\n click 'CANCEL' to refresh the page.")?window.location.replace("/locations"):window.location.reload())):(EventApp.$(".subheader").html(moment(b.get("start").local).format("MMMM Do, YYYY")).prev().html(b.get("venue").address.city+", "+b.get("venue").address.region),this.event_when_where&&this.displayWhenWhere(b),this.event_settings&&this.displaySettings(b),this.map&&this.drawMap(b),b.get("public")?(this.showPublicDetails(),this.event_links&&this.displayLinks(b),this.event_tickets?this.displayTickets(b):void 0):this.showRegForm())}),jQuery(document).ready(function(a){return EventApp.$=a,_.isUndefined(data.event)?void 0:EventApp.start(data.event)});